<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Emotion Detector ðŸŽ­</title>

<style>
body {
  font-family: "Segoe UI", system-ui, sans-serif;
  background: linear-gradient(135deg, #0f0f14, #1e1e2e);
  color: #e0e0e0;
  margin: 0;
  padding: 30px;
  min-height: 100vh;
}

h1 {
  text-align: center;
  font-size: 3.5rem;
  margin-bottom: 40px;
  color: #6ab3f3;
}

.container {
  max-width: 960px;
  margin: auto;
  background: #1e1e2e;
  border-radius: 16px;
  padding: 25px;
  box-shadow: 0 12px 40px rgba(0,0,0,0.55);
}

.upload-area {
  border: 2px dashed #444;
  border-radius: 12px;
  padding: 30px;
  text-align: center;
  cursor: pointer;
  background: #252536;
  transition: all 0.2s ease;
}

.upload-area:hover {
  border-color: #6ab3f3;
  background: #2a2a3c;
}

#fileInput { display: none; }

#imagePreview {
  display: none;
  max-width: 100%;
  margin: 20px auto;
  border-radius: 10px;
  border: 1px solid #333;
}

button {
  width: 100%;
  margin-top: 15px;
  padding: 14px;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 10px;
  border: none;
  background: #6ab3f3;
  color: #111;
  cursor: pointer;
}

button:disabled {
  background: #444;
  color: #777;
  cursor: not-allowed;
}

.loader {
  display: none;
  margin: 25px auto;
  border: 4px solid #333;
  border-top: 4px solid #6ab3f3;
  border-radius: 50%;
  width: 42px;
  height: 42px;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.result {
  display: none;
  margin-top: 30px;
  background: #252536;
  border-radius: 14px;
  padding: 25px;
  border: 1px solid #333;
  text-align: center;
}

.result h2 {
  margin-bottom: 10px;
  color: #6ab3f3;
}

#emotionGif {
  display: none;
  max-width: 180px;
  margin: 20px auto;
}

.audio-container {
  display: none;
  margin-top: 20px;
}

audio {
  width: 100%;
}

.error {
  color: #f87171;
  text-align: center;
  margin-top: 15px;
}
</style>
</head>

<body>

<h1>ðŸŽ­ Emotion Detector</h1>

<div class="container">

  <div class="upload-area" id="dropArea">
    <p>ðŸ“· Click or drag & drop an image</p>
    <input type="file" id="fileInput" accept="image/*">
  </div>

  <img id="imagePreview">

  <button id="analyzeBtn" disabled>Analyze Emotion</button>

  <div class="loader" id="loader"></div>
  <div class="error" id="errorMsg"></div>

  <div class="result" id="result">
    <h2 id="emotionText"></h2>
    <p>Confidence: <strong><span id="confidenceText"></span>%</strong></p>

    <img id="emotionGif" />

    <div class="audio-container" id="audioContainer">
      <audio id="emotionAudio" controls></audio>
    </div>
  </div>

</div>

<script>
/* ---------------------------
   Emotion â†’ Assets (FRONTEND)
---------------------------- */

const EMOTION_GIF_MAP = {
  happy: "./emoji/happy.gif",
  sad: "emoji/sad.gif",
  angry: "emoji/angry.gif",
  surprise: "emoji/surprise.gif",
  fear: "emoji/fear.gif",
  neutral: "emoji/neutral.gif",
  disgust: "emoji/disgust.gif"
};

const EMOTION_SONG_MAP = {
  happy: "songs/happy.mp3",
  sad: "songs/sad.mp3",
  angry: "songs/angry.mp3",
  surprise: "songs/surprise.mp3",
  fear: "songs/fear.mp3",
  neutral: "songs/neutral.mp3",
  disgust: "songs/disgust.mp3"
};

/* ---------------------------
   DOM refs
---------------------------- */

const fileInput = document.getElementById("fileInput");
const dropArea = document.getElementById("dropArea");
const imagePreview = document.getElementById("imagePreview");
const analyzeBtn = document.getElementById("analyzeBtn");
const loader = document.getElementById("loader");
const resultBox = document.getElementById("result");
const errorMsg = document.getElementById("errorMsg");

const emotionText = document.getElementById("emotionText");
const confidenceText = document.getElementById("confidenceText");
const emotionGif = document.getElementById("emotionGif");
const audioContainer = document.getElementById("audioContainer");
const emotionAudio = document.getElementById("emotionAudio");

let selectedFile = null;

/* ---------------------------
   Upload handling
---------------------------- */

dropArea.onclick = () => fileInput.click();

fileInput.onchange = e => handleFile(e.target.files[0]);

dropArea.ondragover = e => {
  e.preventDefault();
  dropArea.style.borderColor = "#6ab3f3";
};

dropArea.ondragleave = () => {
  dropArea.style.borderColor = "#444";
};

dropArea.ondrop = e => {
  e.preventDefault();
  dropArea.style.borderColor = "#444";
  handleFile(e.dataTransfer.files[0]);
};

function handleFile(file) {
  if (!file || !file.type.startsWith("image/")) {
    showError("Please upload a valid image file.");
    return;
  }

  selectedFile = file;
  analyzeBtn.disabled = false;
  errorMsg.textContent = "";

  const reader = new FileReader();
  reader.onload = e => {
    imagePreview.src = e.target.result;
    imagePreview.style.display = "block";
  };
  reader.readAsDataURL(file);
}

/* ---------------------------
   Analyze
---------------------------- */

analyzeBtn.onclick = async () => {
  if (!selectedFile) return;

  loader.style.display = "block";
  resultBox.style.display = "none";
  emotionGif.style.display = "none";
  audioContainer.style.display = "none";
  emotionAudio.pause();
  errorMsg.textContent = "";

  const formData = new FormData();
  formData.append("file", selectedFile);

  try {
    const res = await fetch("/detect_emotion", {
      method: "POST",
      body: formData
    });

    const data = await res.json();
    loader.style.display = "none";

    if (!res.ok) throw new Error(data.error || "Server error");

    const emotion = data.emotion.toLowerCase();

    emotionText.textContent = emotion.toUpperCase();
    confidenceText.textContent = data.confidence;

    /* GIF */
    if (EMOTION_GIF_MAP[emotion]) {
      emotionGif.src = EMOTION_GIF_MAP[emotion];
      emotionGif.style.display = "block";
    }

    /* SONG */
    if (EMOTION_SONG_MAP[emotion]) {
      emotionAudio.src = EMOTION_SONG_MAP[emotion];
      audioContainer.style.display = "block";
      emotionAudio.load();
      emotionAudio.play().catch(() => {});
    }

    resultBox.style.display = "block";

  } catch (err) {
    loader.style.display = "none";
    showError(err.message);
  }
};

function showError(msg) {
  errorMsg.textContent = msg;
}
</script>

</body>
</html>
